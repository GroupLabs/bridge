name: End-to-End Tests for Bridge
run-name: ${{ github.actor }} is running e2e tests for Bridge ðŸš€
on: 
    pull_request:
    workflow_dispatch:
    push:
        branches:
            - main

jobs:
    run-e2e-tests:
        runs-on: ubuntu-20.04
        steps:
            - name: Checkout code
              uses: actions/checkout@v2
            - name: Check if docker is installed
              run: docker --version
            - name: Check if docker-compose plugin is installed
              run: docker compose version
            - name: Check if Python is installed
              run: python --version

            # TODO: consider using requirements.txt or using Poetry if more dependencies are added
            - name: Install dotenv
              run: pip install python-dotenv

            - name: Initialize the .env file
              run: python src/init_env.py -- --skip-prompts
            - name: Navigate to the deployment directory and start the containers
              run: cd src/deployment && docker compose --profile ci up -d
            - name: Ensure successful test run
              run: docker wait deployment-e2e-tests-1
            - name: Stop the containers
              run: cd src/deployment && docker compose down

